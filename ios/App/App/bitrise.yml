format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

project_type: ios

workflows:
  primary:
    steps:
      - git-clone: {}
      - cache-pull: {}
      - script:
          title: Install CocoaPods
          inputs:
            - content: |
                #!/bin/bash
                set -ex
                cd ios/App
                pod install
      - certificate-and-profile-installer: {}
      - xcode-archive:
          inputs:
            - project_path: ios/App/App.xcworkspace
            - scheme: App
            - export_method: app-store
            - configuration: Release
      - deploy-to-bitrise-io: {}
      - deploy-to-itunesconnect-application-loader:
          inputs:
            - app_password: "$APPLE_PWD"
            - apple_id: "$APPLE_LOGIN"
            - ipa_path: "$BITRISE_IPA_PATH"
    envs:
      - BITRISE_PROJECT_PATH: ios/App/App.xcworkspace
      - BITRISE_SCHEME: App
      - BITRISE_EXPORT_METHOD: app-store
